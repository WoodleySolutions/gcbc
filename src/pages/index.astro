---
import Layout from '../layouts/Layout.astro';
import NextEventBanner from '../components/NextEventBanner.astro';
import { getCurrentEventText } from '../lib/currentEvent';
import { client, queries, urlFor, getSiteSettings, getCurrentBook, getFeaturedPosts, type BlogPost } from '../lib/sanity';

const eventText = getCurrentEventText();

// Fetch CMS data
const [siteSettings, currentBook, featuredPosts, everyBookCatholicPost] = await Promise.all([
  getSiteSettings(),
  getCurrentBook(),
  getFeaturedPosts(),
  client.fetch(`*[_type == "blogPost" && slug.current == "why-is-every-book-catholic"][0]`)
]);

// Helper function to format dates
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
---

<Layout title="Great Catholic Book Club - Every Book is Catholic">
  <!-- Hero Section -->
  <section class="bg-black-olive relative">
    <!-- Background image for ancient library feel -->
    <div class="absolute inset-0 bg-cover bg-center bg-no-repeat" style="background-image: url('/images/SiteImages/A vast dimly lit library full of ancient interesting and colorful books.jpg');"></div>
    <!-- Overlay for readability -->
    <div class="absolute inset-0 bg-gradient-to-b from-black-olive/80 via-black-olive/85 to-black-olive/90"></div>
    <div class="max-w-7xl mx-auto px-4 py-16 sm:py-24 relative z-10">
      <div class="text-center">
        <h1 class="text-4xl sm:text-6xl font-bold text-champaign-100 mb-4 font-headline drop-shadow-lg">
          Great Catholic Book Club
        </h1>
        <p class="text-2xl text-rust-400 font-semibold mb-6 font-headline">
          "Every Book is Catholic"
        </p>
        <blockquote class="text-lg text-champaign-200 max-w-4xl mx-auto mb-8 italic leading-relaxed">
          For as I walked around looking carefully at your shrines, I even discovered an altar inscribed, 'To an Unknown God.' What therefore you unknowingly worship, I proclaim to you. <span class="text-champaign-300">-Acts of the Apostles 17:23</span>
        </blockquote>
      </div>
    </div>
  </section>

  <!-- Welcome Section -->
  <section class="py-20 bg-gradient-to-b from-black-olive via-black-olive to-rust-800/20 relative">
    <!-- Decorative background pattern -->
    <div class="absolute inset-0 opacity-5">
      <div class="absolute top-10 left-10 w-32 h-32 border border-champaign-300 rounded-full"></div>
      <div class="absolute top-32 right-20 w-24 h-24 border border-rust-400 rounded-full"></div>
      <div class="absolute bottom-20 left-1/4 w-20 h-20 border border-champaign-300 rounded-full"></div>
      <div class="absolute bottom-10 right-1/3 w-28 h-28 border border-rust-400 rounded-full"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 relative z-10">
      <div class="max-w-5xl mx-auto">
        <div class="bg-gradient-to-br from-black-olive/90 to-black-olive/70 border-2 border-champaign-700/40 rounded-2xl p-12 shadow-2xl backdrop-blur-sm">
          <div class="text-center">
            <div class="mb-8">
              <h2 class="text-4xl sm:text-5xl font-bold text-champaign-100 mb-4 font-headline drop-shadow-lg">
                Welcome to<br />Great Catholic Book Club!
              </h2>
              <div class="w-24 h-1 bg-gradient-to-r from-rust-400 to-champaign-300 mx-auto rounded-full"></div>
            </div>

            <div class="space-y-6">
              <p class="text-xl text-champaign-200 leading-relaxed font-medium">
                We are an online discussion club, content hub, and charitable ministry for people who want to grow in their relationship with Jesus Christ—wherever that is—by enjoying good literature and art through the lens of the Catholic faith.
              </p>

              <div class="bg-rust-800/30 border border-rust-600/30 rounded-xl p-6 mx-auto max-w-3xl">
                <p class="text-lg text-champaign-100 leading-relaxed italic">
                  "Together, we explore how the beauty of creativity and faith yields perfect spiritual fruit. We believe that art is how we become full human beings, and
                  <span class="text-rust-300 font-semibold">'the glory of God is man fully alive.'"</span>
                </p>
              </div>

              <p class="text-lg text-champaign-200 leading-relaxed">
                Follow along on your own with our 2025 Book List, and subscribe to our newsletter to get updates on blog and video content that will be released throughout the year.
                <span class="text-rust-300 font-semibold">Everything is free.</span> Choose whatever works best for you!
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Current Book Section -->
  {currentBook && (
    <section class="py-16 bg-rust-800">
      <div class="max-w-6xl mx-auto px-4">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Currently Reading</h2>
          <p class="text-champaign-200">
            {currentBook.meetingDate
              ? `Join us for our ${formatDate(currentBook.meetingDate)} discussion`
              : eventText.joinPrompt
            }
          </p>
        </div>
        <div class="bg-black-olive border border-champaign-700/30 rounded-lg p-8 shadow-2xl">
          <div class="grid md:grid-cols-3 gap-8 items-center">
            <div class="aspect-[3/4] bg-black-olive border border-champaign-700/20 rounded-lg shadow-inner overflow-hidden mx-auto max-w-sm">
              {currentBook.coverImage ? (
                <img
                  src={urlFor(currentBook.coverImage).width(300).height(400).url()}
                  alt={currentBook.title}
                  class="w-full h-full object-cover"
                />
              ) : (
                <div class="w-full h-full flex items-center justify-center text-champaign-300 text-center p-4">
                  <span class="text-sm">No Cover Available</span>
                </div>
              )}
            </div>
            <div class="md:col-span-2">
              <h3 class="text-2xl font-bold text-champaign-100 mb-2 font-headline">{currentBook.title}</h3>
              <p class="text-champaign-200 mb-2 text-lg">By {currentBook.author}</p>
              {currentBook.theme && (
                <p class="text-rust-400 font-semibold font-headline mb-4">{currentBook.theme}</p>
              )}
              {currentBook.description && (
                <p class="text-champaign-200 mb-4 leading-relaxed">{currentBook.description}</p>
              )}
              <div class="bg-black-olive/50 border border-champaign-700/20 rounded-lg p-4 mb-6">
                <p class="text-champaign-200 text-sm leading-relaxed">
                  {eventText.joinPrompt} {eventText.scheduleText} {eventText.joinNowText}
                </p>
              </div>
              <div class="flex flex-wrap gap-4">
                <a href="/books" class="inline-block bg-champaign-100 text-rust-800 px-6 py-3 rounded-lg font-semibold hover:bg-champaign-200 transition-colors">
                  View Full Reading List
                </a>
                <a href="/join" class="inline-block bg-rust-600 text-champaign-100 px-6 py-3 rounded-lg font-semibold hover:bg-rust-700 transition-colors">
                  Join Discussion
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- YouTube Section -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Subscribe to our YouTube Channel!</h2>
        <p class="text-lg text-champaign-200 mb-8">Check out our video going over all the books on our 2025 List:</p>
      </div>

      <div class="max-w-4xl mx-auto">
        <div class="aspect-video bg-black-olive border border-champaign-700/30 rounded-lg overflow-hidden shadow-2xl">
          <iframe
            width="100%"
            height="100%"
            src="https://www.youtube.com/embed/ysInxBrYBQ4"
            title="2025 Book List Video"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            class="w-full h-full"
          ></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Every Book is Catholic -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-champaign-100 mb-6 font-headline">Why is every book Catholic?</h2>

        <div class="bg-black-olive border border-champaign-700/30 rounded-lg p-8 shadow-2xl mb-8">
          <p class="text-lg text-champaign-200 mb-4">
            <strong class="text-champaign-100">Short answer:</strong> Because every book can (and in our humble opinion, should) be interpreted through the lens of the Catholic intellectual tradition.
          </p>

          <p class="text-lg text-champaign-200 mb-6">
            <strong class="text-champaign-100">Long answer:</strong> Every book isn't intentionally Catholic. People create art from a variety of different cultural, historical, and personal viewpoints. We believe there is one perfect perspective that encompasses all that is true, good, and beautiful; it doesn't erase any point of view, but instead refines it. That is the perspective of Jesus Christ. If you really want to enjoy a good book, do it with Jesus!
          </p>

          {everyBookCatholicPost ? (
            <a href={`/blog/${everyBookCatholicPost.slug.current}`} class="text-rust-400 hover:text-rust-300 font-semibold transition-colors">
              Read more here...
            </a>
          ) : (
            <a href="/blog" class="text-rust-400 hover:text-rust-300 font-semibold transition-colors">
              Read more on our blog...
            </a>
          )}
        </div>

        <p class="text-xl text-champaign-100 font-semibold mb-6 font-headline">
          Join the book club to start that journey in 2025!
        </p>
        <a href="/join" class="inline-block bg-rust-800 text-champaign-100 px-8 py-3 rounded-lg text-lg font-semibold hover:bg-rust-900 transition-colors shadow-md">
          Join Now
        </a>
      </div>
    </div>
  </section>

  <!-- Blog Section -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Latest from the Blog</h2>
        <p class="text-champaign-200">Explore our thoughts on faith, literature, and the Catholic intellectual tradition</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
        {featuredPosts && featuredPosts.length > 0 ? (
          featuredPosts.map((post) => (
            <article class="bg-black-olive border border-champaign-700/30 rounded-lg overflow-hidden shadow-xl hover:shadow-2xl transition-shadow">
              {post.featuredImage && (
                <div class="aspect-video overflow-hidden">
                  <img
                    src={urlFor(post.featuredImage).width(400).height(225).url()}
                    alt={post.title}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  />
                </div>
              )}
              <div class="p-6">
                <h3 class="text-xl font-bold text-champaign-100 mb-2 font-headline line-clamp-2">
                  {post.title}
                </h3>
                <p class="text-champaign-300 text-sm mb-3">
                  {formatDate(post.publishedAt)}
                </p>
                <p class="text-champaign-200 text-sm mb-4 line-clamp-3 leading-relaxed">
                  {post.excerpt}
                </p>
                <a
                  href={`/blog/${post.slug.current}`}
                  class="inline-block text-rust-400 hover:text-rust-300 font-semibold text-sm transition-colors"
                >
                  Read More →
                </a>
              </div>
            </article>
          ))
        ) : (
          <div class="bg-black-olive border border-champaign-700/30 rounded-lg p-6 text-center shadow-xl col-span-full">
            <p class="text-champaign-300">Featured blog posts will appear here once created in the CMS</p>
          </div>
        )}
      </div>

      <div class="text-center">
        <a href="/blog" class="inline-block bg-rust-800 text-champaign-100 px-8 py-3 rounded-lg font-semibold hover:bg-rust-900 transition-colors shadow-md">
          View All Posts
        </a>
      </div>
    </div>
  </section>

  <!-- Store Section -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Shop</h2>
        <p class="text-champaign-200">Support the ministry with books and merchandise</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
        <!-- Store items will be populated by Printify -->
        <div class="bg-black-olive border border-champaign-700/30 rounded-lg p-6 text-center shadow-2xl">
          <p class="text-champaign-300">Store items will appear here</p>
        </div>
      </div>

      <div class="text-center">
        <a href="/shop" class="inline-block bg-rust-800 text-champaign-100 px-8 py-3 rounded-lg font-semibold hover:bg-rust-900 transition-colors shadow-md">
          Visit Store
        </a>
      </div>
    </div>
  </section>

  <!-- Newsletter Signup -->
  <section class="py-16 bg-rust-800 text-champaign-100">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-4 font-headline">Sign up for newsletter</h2>
      <p class="text-champaign-200 mb-8">
        Get updates on blog and video content, book discussions, and event announcements.
      </p>

      <form name="newsletter" method="POST" data-netlify="true" class="max-w-md mx-auto flex gap-4">
        <input type="hidden" name="form-name" value="newsletter" />
        <input
          type="email"
          name="email"
          placeholder="Enter your email"
          class="flex-1 px-4 py-3 rounded-lg text-black-olive bg-champaign-100 border border-champaign-300 focus:ring-2 focus:ring-champaign-200"
          required
        />
        <button
          type="submit"
          class="bg-champaign-100 text-rust-800 px-6 py-3 rounded-lg font-semibold hover:bg-champaign-200 transition-colors shadow-md"
        >
          Subscribe
        </button>
      </form>
    </div>
  </section>
</Layout>
