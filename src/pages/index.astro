---
import Layout from '../layouts/Layout.astro';
import NextEventBanner from '../components/NextEventBanner.astro';
import { client, queries, urlFor, extractYouTubeId, getSiteSettings, getCurrentBook, getFeaturedPosts, type BlogPost } from '../lib/sanity';

// Fetch CMS data
const [siteSettings, currentBook, featuredPosts, everyBookCatholicPost] = await Promise.all([
  getSiteSettings(),
  getCurrentBook(),
  getFeaturedPosts(),
  client.fetch(`*[_type == "blogPost" && slug.current == "why-is-every-book-catholic"][0]`)
]);

// Helper function to format dates (parses as local date to avoid timezone issues)
const formatDate = (dateString: string) => {
  // Append time to parse as local date instead of UTC
  const date = new Date(dateString + 'T12:00:00');
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

// Helper function to get YouTube video ID from post
const getVideoId = (post: BlogPost): string | null => {
  if (post.postType === 'video' && post.youtubeVideo?.url) {
    return extractYouTubeId(post.youtubeVideo.url);
  }
  return null;
};

// Structured data for homepage (Organization)
const organizationData = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Great Catholic Book Club",
  "url": "https://greatcatholicbookclub.com",
  "logo": "https://greatcatholicbookclub.com/GCBC_Logo_ForDarkBG.png",
  "description": "An online discussion club and content hub for people who want to grow in their relationship with Jesus Christ by enjoying good literature and art through the lens of the Catholic faith.",
  "slogan": "Every Book is Catholic",
  "foundingDate": "2024",
  "sameAs": [
    "https://www.youtube.com/@TheGreatCatholicBookClub"
  ]
};
---

<Layout
  title="Great Catholic Book Club - Every Book is Catholic"
  description="Join our Catholic book club exploring great literature through faith. Monthly discussions, reading guides, and a community growing in Christ through books and art."
>
  <!-- Structured Data for SEO -->
  <script type="application/ld+json" set:html={JSON.stringify(organizationData)} />
  <!-- Hero Section -->
  <section class="bg-black-olive relative">
    <!-- Background image for ancient library feel -->
    <div class="absolute inset-0 bg-cover bg-center bg-no-repeat" style="background-image: url('/images/SiteImages/A vast dimly lit library full of ancient interesting and colorful books.jpg');"></div>
    <!-- Overlay for readability -->
    <div class="absolute inset-0 bg-gradient-to-b from-black-olive/80 via-black-olive/85 to-black-olive/90"></div>
    <div class="max-w-7xl mx-auto px-4 py-16 sm:py-24 relative z-10">
      <div class="text-center">
        <h1 class="text-4xl sm:text-6xl font-bold text-champaign-100 mb-4 font-headline drop-shadow-lg">
          Great Catholic Book Club
        </h1>
        <p class="text-2xl text-rust-400 font-semibold mb-6 font-headline">
          "Every Book is Catholic"
        </p>
        <blockquote class="text-lg text-champaign-200 max-w-4xl mx-auto mb-8 italic leading-relaxed">
          For as I walked around looking carefully at your shrines, I even discovered an altar inscribed, 'To an Unknown God.' What therefore you unknowingly worship, I proclaim to you. <span class="text-champaign-300">-Acts of the Apostles 17:23</span>
        </blockquote>
      </div>
    </div>
  </section>

  <!-- Welcome Section -->
  <section class="py-20 bg-gradient-to-b from-black-olive via-black-olive to-rust-800/20 relative">
    <!-- Decorative background pattern -->
    <div class="absolute inset-0 opacity-5">
      <div class="absolute top-10 left-10 w-32 h-32 border border-champaign-300 rounded-full"></div>
      <div class="absolute top-32 right-20 w-24 h-24 border border-rust-400 rounded-full"></div>
      <div class="absolute bottom-20 left-1/4 w-20 h-20 border border-champaign-300 rounded-full"></div>
      <div class="absolute bottom-10 right-1/3 w-28 h-28 border border-rust-400 rounded-full"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 relative z-10">
      <div class="max-w-5xl mx-auto">
        <div class="bg-gradient-to-br from-black-olive/90 to-black-olive/70 border-2 border-champaign-700/40 rounded-2xl p-12 shadow-2xl backdrop-blur-sm">
          <div class="text-center">
            <div class="mb-8">
              <h2 class="text-4xl sm:text-5xl font-bold text-champaign-100 mb-4 font-headline drop-shadow-lg">
                Welcome to<br />Great Catholic Book Club!
              </h2>
              <div class="w-24 h-1 bg-gradient-to-r from-rust-400 to-champaign-300 mx-auto rounded-full"></div>
            </div>

            <div class="space-y-6">
              <p class="text-xl text-champaign-200 leading-relaxed font-medium">
                We are an online discussion club and content hub for people who want to grow in their relationship with Jesus Christ—wherever that is—by enjoying good literature and art through the lens of the Catholic faith.
              </p>

              {currentBook ? (
                <p class="text-lg text-champaign-200 leading-relaxed">
                  Join us for our 2026 reading adventure exploring the theme <strong class="text-flame-400">"War is Heck"</strong>—examining human conflict, virtue in adversity, and heroic sacrifice through the lens of Catholic faith. Our next meeting will be held on {currentBook.meetingDate ? new Date(currentBook.meetingDate + 'T12:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric' }) : 'TBD'} at 7pm CST to discuss <em>{currentBook.title}</em> by {currentBook.author}. <a href="/books" class="text-flame-400 hover:text-flame-300 underline font-semibold">View our complete 2026 book list</a> or <a href="/join" class="text-flame-400 hover:text-flame-300 underline font-semibold">subscribe to get the Study Guide</a> and updates on our blog and video content!
                </p>
              ) : (
                <p class="text-lg text-champaign-200 leading-relaxed">
                  Join us for our 2026 reading adventure exploring the theme <strong class="text-flame-400">"War is Heck"</strong>—examining human conflict, virtue in adversity, and heroic sacrifice through the lens of Catholic faith. <a href="/books" class="text-flame-400 hover:text-flame-300 underline font-semibold">View our complete 2026 book list</a> or <a href="/join" class="text-flame-400 hover:text-flame-300 underline font-semibold">subscribe to get the Study Guide</a> and updates on our blog and video content!
                </p>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Current Book Section -->
  {currentBook && (
    <section class="py-16 bg-rust-800">
      <div class="max-w-6xl mx-auto px-4">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Currently Reading</h2>
          <p class="text-champaign-200">
            {currentBook.meetingDate
              ? `Join us for our ${formatDate(currentBook.meetingDate)} discussion`
              : eventText.joinPrompt
            }
          </p>
        </div>
        <div class="bg-black-olive border border-champaign-700/30 rounded-lg p-8 shadow-2xl">
          <div class="grid md:grid-cols-3 gap-8 items-center">
            <div class="aspect-[3/4] bg-black-olive border border-champaign-700/20 rounded-lg shadow-inner overflow-hidden mx-auto max-w-sm">
              {currentBook.coverImage ? (
                <img
                  src={urlFor(currentBook.coverImage).width(300).height(400).url()}
                  alt={currentBook.title}
                  class="w-full h-full object-cover"
                />
              ) : (
                <div class="w-full h-full flex items-center justify-center text-champaign-300 text-center p-4">
                  <span class="text-sm">No Cover Available</span>
                </div>
              )}
            </div>
            <div class="md:col-span-2">
              <h3 class="text-2xl font-bold text-champaign-100 mb-2 font-headline">{currentBook.title}</h3>
              <p class="text-champaign-200 mb-2 text-lg">By {currentBook.author}</p>
              {currentBook.theme && (
                <p class="text-rust-400 font-semibold font-headline mb-4">{currentBook.theme}</p>
              )}
              {currentBook.description && (
                <p class="text-champaign-200 mb-4 leading-relaxed">{currentBook.description}</p>
              )}
              <div class="bg-black-olive/50 border border-champaign-700/20 rounded-lg p-4 mb-6">
                <p class="text-champaign-200 text-sm leading-relaxed">
                  Join the Book Club to get the 2026 Study Guide and participate in monthly online group discussions! Monthly meetings are held on the last Monday of every month at 7pm CST (except November, which is the 3rd Monday to avoid Thanksgiving week). You can join anytime during the year, starting now!
                </p>
              </div>
              <div class="flex flex-wrap gap-4">
                <a href="/books" class="inline-block bg-champaign-100 text-rust-800 px-6 py-3 rounded-lg font-semibold hover:bg-champaign-200 transition-colors">
                  View Full Reading List
                </a>
                <a href="/join" class="inline-block bg-rust-600 text-champaign-100 px-6 py-3 rounded-lg font-semibold hover:bg-rust-700 transition-colors">
                  Join Discussion
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- YouTube Section -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Subscribe to our YouTube Channel!</h2>
        <p class="text-lg text-champaign-200 mb-8">Check out our video going over all the books on our 2025 List:</p>
      </div>

      <div class="max-w-4xl mx-auto">
        <div class="aspect-video bg-black-olive border border-champaign-700/30 rounded-lg overflow-hidden shadow-2xl">
          <iframe
            width="100%"
            height="100%"
            src="https://www.youtube.com/embed/ysInxBrYBQ4"
            title="2025 Book List Video"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            class="w-full h-full"
          ></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Every Book is Catholic -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-champaign-100 mb-6 font-headline">Why is every book Catholic?</h2>

        <div class="bg-black-olive border border-champaign-700/30 rounded-lg p-8 shadow-2xl mb-8">
          <p class="text-lg text-champaign-200 mb-4">
            <strong class="text-champaign-100">Short answer:</strong> Because every book can (and in our humble opinion, should) be interpreted through the lens of the Catholic intellectual tradition.
          </p>

          <p class="text-lg text-champaign-200 mb-6">
            <strong class="text-champaign-100">Long answer:</strong> Every book isn't intentionally Catholic. People create art from a variety of different cultural, historical, and personal viewpoints. We believe there is one perfect perspective that encompasses all that is true, good, and beautiful; it doesn't erase any point of view, but instead refines it. That is the perspective of Jesus Christ. If you really want to enjoy a good book, do it with Jesus!
          </p>

          {everyBookCatholicPost ? (
            <a href={`/blog/${everyBookCatholicPost.slug.current}`} class="text-rust-400 hover:text-rust-300 font-semibold transition-colors">
              Read more here...
            </a>
          ) : (
            <a href="/blog" class="text-rust-400 hover:text-rust-300 font-semibold transition-colors">
              Read more on our blog...
            </a>
          )}
        </div>

        <p class="text-xl text-champaign-100 font-semibold mb-6 font-headline">
          Join the book club to start that journey in 2026!
        </p>
        <a href="/join" class="inline-block bg-rust-800 text-champaign-100 px-8 py-3 rounded-lg text-lg font-semibold hover:bg-rust-900 transition-colors shadow-md">
          Join Now
        </a>
      </div>
    </div>
  </section>

  <!-- Blog Section -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Latest from the Blog</h2>
        <p class="text-champaign-200">Explore our thoughts on faith, literature, and the Catholic intellectual tradition</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
        {featuredPosts && featuredPosts.length > 0 ? (
          featuredPosts.map((post) => (
            <article class="bg-black-olive border border-champaign-700/30 rounded-lg overflow-hidden shadow-xl hover:shadow-2xl transition-shadow">
              {getVideoId(post) ? (
                <div class="aspect-video overflow-hidden">
                  <img
                    src={`https://img.youtube.com/vi/${getVideoId(post)}/maxresdefault.jpg`}
                    alt={post.title}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  />
                </div>
              ) : post.featuredImage ? (
                <div class="aspect-video overflow-hidden">
                  <img
                    src={urlFor(post.featuredImage).width(400).height(225).url()}
                    alt={post.title}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  />
                </div>
              ) : null}
              <div class="p-6">
                <h3 class="text-xl font-bold text-champaign-100 mb-2 font-headline line-clamp-2">
                  {post.title}
                </h3>
                <p class="text-champaign-300 text-sm mb-3">
                  {formatDate(post.publishedAt)}
                </p>
                <p class="text-champaign-200 text-sm mb-4 line-clamp-3 leading-relaxed">
                  {post.excerpt}
                </p>
                <a
                  href={`/blog/${post.slug.current}`}
                  class="inline-block text-rust-400 hover:text-rust-300 font-semibold text-sm transition-colors"
                >
                  Read More →
                </a>
              </div>
            </article>
          ))
        ) : (
          <div class="bg-black-olive border border-champaign-700/30 rounded-lg p-6 text-center shadow-xl col-span-full">
            <p class="text-champaign-300">Featured blog posts will appear here once created in the CMS</p>
          </div>
        )}
      </div>

      <div class="text-center">
        <a href="/blog" class="inline-block bg-rust-800 text-champaign-100 px-8 py-3 rounded-lg font-semibold hover:bg-rust-900 transition-colors shadow-md">
          View All Posts
        </a>
      </div>
    </div>
  </section>

  <!-- Store Section -->
  <section class="py-16 bg-black-olive">
    <div class="max-w-7xl mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-champaign-100 mb-4 font-headline">Shop</h2>
        <p class="text-champaign-200">Support the ministry with books and merchandise</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12 max-w-4xl mx-auto">

        <!-- Coffee Mug -->
        <article class="bg-black-olive border border-champaign-700/30 rounded-lg overflow-hidden shadow-xl hover:shadow-2xl transition-shadow">
          <div class="aspect-square overflow-hidden bg-white">
            <img
              src="/images/products/mug-main.png"
              alt="Great Catholic Book Club Coffee Mug"
              class="w-full h-full object-contain hover:scale-105 transition-transform duration-300"
            />
          </div>
          <div class="p-6">
            <h3 class="text-xl font-bold text-champaign-100 mb-2 font-headline">
              Great Catholic Book Club Coffee Mug
            </h3>
            <p class="text-2xl font-bold text-champaign-100 mb-2">$15</p>
            <p class="text-champaign-300 text-sm mb-4">Free shipping included</p>
            <p class="text-champaign-200 text-sm mb-4 line-clamp-3 leading-relaxed">
              Start your reading session with a warm cup of coffee in the official Great Catholic Book Club mug. Perfect for those quiet mornings with Scripture or contemplative afternoons with the month's selection.
            </p>
            <a
              href="/shop"
              class="block w-full bg-rust-800 text-champaign-100 text-center px-6 py-3 rounded-lg font-semibold hover:bg-rust-900 transition-colors"
            >
              View Details
            </a>
          </div>
        </article>

        <!-- Tote Bag -->
        <article class="bg-black-olive border border-champaign-700/30 rounded-lg overflow-hidden shadow-xl hover:shadow-2xl transition-shadow">
          <div class="aspect-square overflow-hidden bg-white">
            <img
              src="/images/products/tote-front.png"
              alt="GCBC Reader's Tote Bag"
              class="w-full h-full object-contain hover:scale-105 transition-transform duration-300"
            />
          </div>
          <div class="p-6">
            <h3 class="text-xl font-bold text-champaign-100 mb-2 font-headline">
              GCBC Reader's Tote Bag
            </h3>
            <p class="text-2xl font-bold text-champaign-100 mb-2">$25</p>
            <p class="text-champaign-300 text-sm mb-4">Free shipping included</p>
            <p class="text-champaign-200 text-sm mb-4 line-clamp-3 leading-relaxed">
              Carry your books, journals, and reading essentials in style. This spacious 18" x 18" tote is perfect for book club meetings, library trips, or quiet reading sessions.
            </p>
            <a
              href="/shop"
              class="block w-full bg-rust-800 text-champaign-100 text-center px-6 py-3 rounded-lg font-semibold hover:bg-rust-900 transition-colors"
            >
              View Details
            </a>
          </div>
        </article>

      </div>

      <div class="text-center">
        <a href="/shop" class="inline-block bg-rust-800 text-champaign-100 px-8 py-3 rounded-lg font-semibold hover:bg-rust-900 transition-colors shadow-md">
          Visit Store
        </a>
      </div>
    </div>
  </section>

  <!-- Newsletter Signup -->
  <section class="py-16 bg-rust-800 text-champaign-100">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-4 font-headline">Sign up for newsletter</h2>
      <p class="text-champaign-200 mb-8">
        Get updates on blog and video content, book discussions, and event announcements.
      </p>

      <form name="newsletter" method="POST" data-netlify="true" action="/success?form=newsletter" class="max-w-md mx-auto">
        <input type="hidden" name="form-name" value="newsletter" />
        <div class="flex gap-4">
          <div class="flex-1">
            <label for="newsletter-email" class="sr-only">Email Address</label>
            <input
              type="email"
              id="newsletter-email"
              name="email"
              placeholder="Enter your email"
              class="w-full px-4 py-3 rounded-lg text-black-olive bg-champaign-100 border border-champaign-300 focus:ring-2 focus:ring-champaign-200"
              required
              aria-required="true"
            />
          </div>
          <button
            type="submit"
            class="bg-champaign-100 text-rust-800 px-6 py-3 rounded-lg font-semibold hover:bg-champaign-200 transition-colors shadow-md"
          >
            Subscribe
          </button>
        </div>
      </form>
    </div>
  </section>
</Layout>
